name: Deploy

on:
  push:
    branches: [ main ]
    tags:
      - 'v*'

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/tags/v')
    
    steps:
    - uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '8.0.x'

    - name: Build
      run: |
        dotnet restore backend/Ledgerly.Backend.sln
        dotnet build backend/Ledgerly.Backend.sln --configuration Release

    - name: Publish
      run: |
        dotnet publish backend/Ledgerly.Api/Ledgerly.Api.csproj \
          --configuration Release \
          --output ./publish

    - name: Create deployment package
      run: |
        tar -czf backend-deploy.tar.gz -C publish .

    # Add your deployment steps here (e.g., upload to server, deploy to cloud, etc.)
    # Example for VPS deployment:
    # - name: Deploy to server
    #   uses: appleboy/scp-action@master
    #   with:
    #     host: ${{ secrets.HOST }}
    #     username: ${{ secrets.USERNAME }}
    #     key: ${{ secrets.SSH_KEY }}
    #     source: "backend-deploy.tar.gz"
    #     target: "/opt/ledgerly"

